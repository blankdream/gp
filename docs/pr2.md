# 股票投资管理小程序开发需求（基于 vk-unicloud-router）

---

## 一、项目简介

- 个人股票投资管理小程序，支持A股、港股股票池管理，实时行情、K线图、分组、备注、搜索等功能。
- 数据接口基于腾讯财经API，前后端统一用 vk-unicloud-router 框架，前端 Vue3 + uView + ECharts，后端统一云函数路由，用户系统集成 uni-id。

---

## 二、主要功能

1. **首页股票池**
   - 展示股票名称、代码、实时价格、涨跌幅、盈亏、分组、备注。
   - 行点击展开详细行情（分时、K线、成交量、市盈率、市值、换手率、振幅、52周高低等）。
   - 支持多开详细信息，按涨跌幅、价格、名称等排序，分组筛选与顶部搜索。

2. **股票管理**
   - 支持按代码/名称模糊搜索（A股、港股），自定义分组，批量移动。

3. **数据获取**
   - 实时行情、K线（日/周/月/分时）、详细数据（市盈率、市值、换手率、振幅、52周高低等）。

4. **交互体验**
   - K线图支持缩放、拖动、切换周期。
   - 手动/自动定时刷新（2秒间隔）。

5. **扩展功能**
   - 预警提醒：可设置价格、涨跌幅等条件，触发订阅消息。

---

## 三、技术架构

- 前端：Vue3 + uView + ECharts，基于 vk-unicloud-router。
- 后端：统一云函数路由（vk-unicloud-router），接口集中管理，便于维护和权限控制。
- 用户系统：uni-id（vk.userCenter），多端登录、权限管理。
- 数据接口：腾讯财经API。
- 数据存储：本地Storage + 云数据库（vk.baseDao）。

---

## 四、项目结构建议

- `uniCloud-aliyun/cloudfunctions/router/`：主云函数目录，所有后端接口统一路由管理
- `uniCloud-aliyun/database/`：数据库 schema、索引、初始化数据
- `uni_modules/vk-unicloud/`：vk-unicloud-router 框架核心
- `store/`：前端 Vuex 状态管理，推荐用 vk 封装的持久化
- `pages/`、`components/`：前端页面与组件
- `common/function/`：通用工具函数

---

## 五、后端接口设计

- 所有接口统一通过 vk-unicloud-router 路由管理，接口风格如：
  - 股票池管理：`stock/pool/add`、`stock/pool/list`、`stock/pool/update`、`stock/pool/delete`
  - 用户分组：`stock/group/add`、`stock/group/list`、`stock/group/delete`
- 推荐接口目录结构：
  ```
  uniCloud-aliyun/cloudfunctions/router/
    └── stock/
        ├── pool.js
        └── group.js
  ```
- 每个接口文件导出多方法，按 action 路由分发。

---

## 六、前后端调用方式

- 前端通过 `vk.callFunction({ url: 'stock/pool/list', data: {} })` 调用后端接口。
- 支持本地开发和云端一键部署。
- 支持全局过滤器、权限校验、token 校验等。

---

## 七、数据库设计

- 股票池表（stock_pool）：用户ID、股票代码、分组、备注、创建/更新时间、预期买入/卖出价等。
- 分组表（stock_group）：用户ID、分组名。
- 用户表（uni-id-users）：使用 uni-id 标准表。

---

## 八、权限与安全

- 利用 vk-unicloud-router 全局过滤器实现接口权限控制。
- 重要接口需校验用户 token，防止未授权访问。
- 支持接口日志、异常捕获。

---

## 九、开发流程建议

1. 初始化项目，安装 vk-unicloud-router 框架。
2. 设计数据库 schema，创建 stock_pool、stock_group 等表。
3. 编写云函数路由接口，按业务模块拆分。
4. 前端通过 vk.callFunction 调用后端接口。
5. 利用 vk.baseDao 快速实现数据库增删改查。
6. 集成 uni-id 用户系统，支持多端登录。
7. 配置全局过滤器，完善权限校验。
8. 前后端联调，完善页面与交互。
9. 测试、优化、上线。

---

## 十、页面与组件规划

- **页面**
  - `pages/index/index.vue`：股票池首页，核心功能集成
  - `pages/alert/alert.vue`：预警提醒设置
  - `pages/user/user.vue`：个人中心

- **组件**
  - `components/StockCard.vue`：股票卡片
  - `components/StockDetail.vue`：股票详细信息
  - `components/KLineChart.vue`：K线图
  - `components/GroupSelector.vue`：分组选择/管理弹窗
  - `components/RemarkEditor.vue`：备注编辑弹窗
  - `components/AlertEditor.vue`：预警条件编辑弹窗
  - `components/UserInfo.vue`：用户信息展示与编辑

---

## 十一、首页股票池页面交互与功能说明

1. **分组筛选与管理**
   - 页面顶部为分组筛选区，可切换不同分组查看对应股票。
   - 分组筛选右侧有“分组管理”按钮，弹窗支持分组的新增、删除，分组变动实时同步到首页和弹窗。

2. **股票列表展示与交互**
   - 列表首行为固定表头（名称、实时价格、涨跌幅、换手率）。
   - 每行默认显示：股票名称、实时价格、涨跌幅、换手率。
   - 支持点击每行展开/收起详细信息和K线图，详情区展示所有行情字段（如股票代码、昨收、今开、成交量、成交额、涨跌额、涨跌幅、市盈率、市值、流通市值、换手率、振幅、最高、最低、52周高低、备注等）。
   - 每行支持长按（400ms）后拖动排序，拖动时有高亮和占位提示，松开后完成排序，排序结果动态更新。

3. **股票搜索与添加**
   - 搜索框位于页面底部，输入时自动请求接口，实时下拉展示匹配股票。
   - 点击下拉项弹窗选择分组和备注，确认后将股票添加到首页列表。
   - “添加股票”弹窗分组支持下拉选择和自定义输入，备注为多行输入。
   - 支持点击空白处关闭下拉。

4. **核心交互体验**
   - 保持股票列表、搜索、拖拽排序、详情展开等核心交互，去除多余按钮和标题，内容完整显示。
   - K线图支持多周期切换、缩放、拖动等交互。
   - 数据支持手动刷新和自动定时刷新（2秒间隔）。

---

## 十二、开发注意事项

- 腾讯API为非官方接口，需做好异常处理和接口变更兼容。
- 注意数据缓存与刷新频率，避免频繁请求被封。
- 严格校验接口返回数据，防止解析错误。
- 仅限个人学习使用，勿用于商业用途。

---

## 十三、后续迭代建议

- 增加美股、基金等支持。
- 增加更多统计分析与可视化。
- 优化移动端交互体验。
- 增加社区、分享等社交功能。

---

> 本文档为开发全流程指引，后续可据此逐步实现各功能模块。
